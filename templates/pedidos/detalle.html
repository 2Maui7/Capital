{% extends 'base.html' %}

{% block title %}Pedido #{{ pedido.id }} - Imprenta Capital{% endblock %}
{% block page_title %}Pedido #{{ pedido.id }}{% endblock %}
{% block page_subtitle %}Detalles del pedido{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-file-text me-2"></i>Información del Pedido
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Cliente:</strong>
                        <p class="mb-1">{{ pedido.cliente.nombre }}</p>
                        {% if pedido.cliente.es_frecuente %}
                            <span class="badge bg-warning"><i class="bi bi-star-fill"></i> Cliente Frecuente</span>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <strong>Material:</strong>
                        <p>{{ pedido.inventario.nombre|default:"No especificado" }}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-12">
                        <strong>Descripción:</strong>
                        <p>{{ pedido.descripcion }}</p>
                    </div>
                </div>
                
                <hr>
                
                <div class="row mb-3">
                    <div class="col-md-3">
                        <strong>Cantidad:</strong>
                        <p class="h5">{{ pedido.cantidad }}</p>
                    </div>
                    <div class="col-md-3">
                        <strong>Precio Unit.:</strong>
                        <p class="h5">Bs. {{ pedido.precio_unitario }}</p>
                    </div>
                    <div class="col-md-3">
                        <strong>Descuento:</strong>
                        <p class="h5">{{ pedido.descuento }}%</p>
                    </div>
                    <div class="col-md-3">
                        <strong>Total:</strong>
                        <p class="h4 text-primary">Bs. {{ pedido.precio_total }}</p>
                    </div>
                </div>
                
                <hr>
                
                <div class="row">
                    <div class="col-md-4">
                        <strong>Estado:</strong>
                        <p>
                            {% if pedido.estado == 'pendiente' %}
                                <span class="badge bg-secondary">Pendiente</span>
                            {% elif pedido.estado == 'en_proceso' %}
                                <span class="badge bg-info">En Proceso</span>
                            {% elif pedido.estado == 'en_produccion' %}
                                <span class="badge bg-warning">En Producción</span>
                            {% elif pedido.estado == 'terminado' %}
                                <span class="badge bg-success">Terminado</span>
                            {% elif pedido.estado == 'entregado' %}
                                <span class="badge bg-primary">Entregado</span>
                            {% else %}
                                <span class="badge bg-danger">Cancelado</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-4">
                        <strong>Fecha Creación:</strong>
                        <p>{{ pedido.fecha_creacion|date:"d/m/Y" }}</p>
                    </div>
                    <div class="col-md-4">
                        <strong>Fecha Entrega:</strong>
                        <p>{{ pedido.fecha_entrega|date:"d/m/Y" }}</p>
                    </div>
                </div>
                
                {% if pedido.usuario_registro %}
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="bi bi-person"></i> Registrado por: {{ pedido.usuario_registro.get_full_name|default:pedido.usuario_registro.username }}
                    </small>
                </div>
                {% endif %}
            </div>
        </div>
        
        {% if pedido.produccion %}
        <div class="card mt-3">
            <div class="card-header">
                <i class="bi bi-gear me-2"></i>Información de Producción
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <strong>Estado Producción:</strong>
                        <p>
                            {% if pedido.produccion.estado == 'no_iniciado' %}
                                <span class="badge bg-secondary">No Iniciado</span>
                            {% elif pedido.produccion.estado == 'en_proceso' %}
                                <span class="badge bg-warning">En Proceso</span>
                            {% elif pedido.produccion.estado == 'pausado' %}
                                <span class="badge bg-danger">Pausado</span>
                            {% else %}
                                <span class="badge bg-success">Terminado</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-4">
                        <strong>Empleado Asignado:</strong>
                        <p>{{ pedido.produccion.empleado.get_full_name|default:"No asignado" }}</p>
                    </div>
                    <div class="col-md-4">
                        <strong>Tiempo Estimado:</strong>
                        <p>{{ pedido.produccion.tiempo_estimado }} horas</p>
                    </div>
                </div>
                
                {% if pedido.produccion.observaciones %}
                <div class="mt-3">
                    <strong>Observaciones:</strong>
                    <p>{{ pedido.produccion.observaciones }}</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-lightning me-2"></i>Acciones
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'core:pedidos_lista' %}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left me-2"></i>Volver a Lista
                    </a>
                    <a href="{% url 'core:pedido_editar' pedido.pk %}" class="btn btn-warning">
                        <i class="bi bi-pencil me-2"></i>Editar Pedido
                    </a>
                    {% if es_administrador %}
                    <a href="{% url 'core:pedido_eliminar' pedido.pk %}" class="btn btn-danger">
                        <i class="bi bi-trash me-2"></i>Eliminar Pedido
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <i class="bi bi-person me-2"></i>Cliente
            </div>
            <div class="card-body">
                <p><strong>{{ pedido.cliente.nombre }}</strong></p>
                {% if pedido.cliente.telefono %}
                <p><i class="bi bi-telephone me-2"></i>{{ pedido.cliente.telefono }}</p>
                {% endif %}
                {% if pedido.cliente.email %}
                <p><i class="bi bi-envelope me-2"></i>{{ pedido.cliente.email }}</p>
                {% endif %}
                <p class="mb-0">
                    <small class="text-muted">Total de pedidos: {{ pedido.cliente.cantidad_pedidos }}</small>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
